@model List<BetterTeamsWebApp.Models.ViewModels.MesssageVM>
@{

    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div class="container">
    <div class="messaging">
        <div class="inbox_msg">
            <div class="mesgs">
                <div id="chatBox" class="msg_history">

                    <!--Receive-->
                    <div class="incoming_msg">
                        <div class="received_msg">
                            <div class="received_withd_msg">
                                <span class="time_date">@User.Identity.Name</span>
                                <p>
                                    Test which is a new approach to have all
                                    solutions
                                </p>
                                <span class="time_date"> 11:01 AM | June 9</span>
                            </div>
                        </div>
                    </div>


                </div>
                <!--Type Message-->
                <div class="type_msg ">
                    <div class="input_msg_write">
                        <input id="msg" class="write_msg" placeholder="Type a message" />
                        <button id="btn" class="msg_send_btn" onclick="sendBtn();">s</button>
                    </div>
                </div>


            </div>
        </div>
    </div>
</div>

<!--Reference the SignalR library. -->
@*<script src="~/Scripts/jquery.signalR-2.4.0.js"></script>*@
<!--Reference the autogenerated SignalR hub script. -->
@*<script src="~/signalr/hubs"></script>*@
<!--SignalR script to update the chat page and send messages.-->

<script>
        var Μessages = () => {
            $.ajax({
                url: 'Home/Index',
                type: 'get',
                success: function (messages) {
                    alert("gg");
                messageListSuccess(messages);
                },
                error: function (request, message, error) {
                handleException(request, message, error);
                }

            });
           
            }


    //test
    var messageListSuccess = (messages) => {

        $.each(messages, function (message) {
            let chatBox = document.getElementById("chatBox");
            chatBox += addMessage(message);
            console.log(message);
        });
    }

    // Handles sendMessage event on send button
    function sendBtn() {
        Message = new Object();
        Message.Message = document.getElementById("msg").value;
        Message.DateTime = Date.now;
        Message.Sender = '@User.Identity.Name';
        Message.Receiver = '';
        console.log(Message);
        $.ajax({
            url: "/Home/Index",
            type: "POST",
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify(Message),
            success: function (Message) {
                alert("GG");
                
                let chatBox = document.getElementById("chatBox");
                chatBox += addMessage(Message);
            },
            error: function (request, message, error) {
                alert("BG");
            }
        });

    }

    //Message Builder
    let addMessage = (Message) => {
        console.log('addMessage run');
        let msgBubble = `
                           <div class="outgoing_msg">
                                <div class="sent_msg">
                                    <span class="time_date">${@User.Identity.Name}</span>
                                    <p>
                                        ${Message.Message}
                                    </p>
                                    <span class="time_date">${Message.DateTime}</span>
                                </div>
                           </div>`;

        return msgBubble;
    }


    //window.addEventListener("load", () => {


    //    let chatBox = document.getElementById("chatBox");
    //    const btn = document.getElementById("btn")

    //    msg.addEventListener("keyup", (event) => {
    //        event.preventDefault();
    //        if (event.keyCode === 13) {
    //            let msg = document.getElementById("msg");

    //            chatBox.innerHTML += `
    //                       <div class="outgoing_msg">
    //                            <div class="sent_msg">
    //                                <p>
    //                                    ${msg.value}
    //                                </p>
    //                                <span class="time_date"> 11:01 AM | June 9</span>
    //                            </div>
    //                       </div>`;
    //            msg.value = "";
    //        }
    //    });

    //    btn.addEventListener("click", () => {
    //        let msg = document.getElementById("msg");
    //        chatBox.innerHTML += `
    //                       <div class="outgoing_msg">
    //                            <div class="sent_msg">
    //                                <p>
    //                                    ${msg.value}
    //                                </p>
    //                                <span class="time_date"> 11:01 AM | June 9</span>
    //                            </div>
    //                       </div>`;
    //        msg.value = "";
    //    });

    //});

</script>



